<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>å¤©æ°”æŸ¥è¯¢</title>
<style>
body {
  background: radial-gradient(circle at top, #1b2b4a, #0b1220);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont;
  padding: 40px;
}
input, button {
  padding: 12px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
}
button {
  margin-left: 10px;
  background: linear-gradient(135deg,#6dd5ed,#2193b0);
  color: white;
}
.card {
  background: rgba(255,255,255,0.08);
  border-radius: 20px;
  padding: 20px;
  margin-top: 20px;
}
.forecast {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}
.day {
  flex: 1;
  background: rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 10px;
  text-align: center;
}
</style>
</head>

<body>

<h1>å¤©æ°”æŸ¥è¯¢</h1>

<input id="city" placeholder="è¾“å…¥åŸå¸‚ï¼Œå¦‚ Osaka" />
<button onclick="search()">æœç´¢</button>

<div id="result"></div>

<script>
const PROXY_BASE = "/weather";

async function search() {
  const city = document.getElementById("city").value;
  if (!city) return;

  // ç”¨ Open-Meteo çš„åœ°ç†ç¼–ç 
  const geo = await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`
  ).then(r => r.json());

  if (!geo.results) {
    alert("æ‰¾ä¸åˆ°åŸå¸‚");
    return;
  }

  const { latitude, longitude, name } = geo.results[0];

  const weather = await fetch(
    `${PROXY_BASE}?lat=${latitude}&lon=${longitude}`
  ).then(r => r.json());

  render(name, weather);
}

function render(city, data) {
  const cur = data.current_weather;
  const daily = data.daily;

  let html = `
    <div class="card">
      <h2>${city}</h2>
      <p>å½“å‰æ¸©åº¦ï¼š${cur.temperature}Â°C</p>
      <p>é£é€Ÿï¼š${cur.windspeed} km/h</p>
    </div>

    <div class="card">
      <h3>æœªæ¥ 7 å¤©</h3>
      <div class="forecast">
  `;

  for (let i = 0; i < daily.time.length; i++) {
    html += `
      <div class="day">
        <div>${daily.time[i]}</div>
        <div>â¬† ${daily.temperature_2m_max[i]}Â°</div>
        <div>â¬‡ ${daily.temperature_2m_min[i]}Â°</div>
        <div>ğŸŒ§ ${daily.precipitation_probability_max[i]}%</div>
      </div>
    `;
  }

  html += `</div></div>`;

  document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>
