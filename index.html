<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Apple Weather Pro</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display";
  background: linear-gradient(180deg, #0a1d37, #071426);
  color: #fff;
}
.container {
  max-width: 480px;
  margin: 0 auto;
  padding: 16px;
}

/* Header */
.header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
}
.sun {
  width: 36px;
  height: 36px;
  animation: spin 18s linear infinite;
}
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
h1 {
  font-size: 20px;
  margin: 0;
  font-weight: 600;
}

/* Inputs */
input, button {
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  border: none;
  margin-bottom: 10px;
  font-size: 15px;
}
input {
  background: rgba(255,255,255,0.12);
  color: white;
}
button {
  background: #4f7cff;
  color: white;
  font-weight: 600;
}

/* Cards */
.card {
  background: rgba(255,255,255,0.12);
  border-radius: 18px;
  padding: 16px;
  margin-top: 12px;
  backdrop-filter: blur(12px);
  animation: fadeIn .4s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: none; }
}

.big {
  font-size: 36px;
  font-weight: 600;
}
.small {
  opacity: .75;
  font-size: 12px;
}

/* Forecast */
.forecast {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  margin-top: 12px;
  padding-bottom: 6px;
}
.day {
  min-width: 120px;
  background: rgba(255,255,255,0.14);
  border-radius: 16px;
  padding: 12px;
  text-align: center;
}
.icon {
  font-size: 22px;
  margin: 6px 0;
}
</style>
</head>

<body>
<div class="container">

  <!-- Header -->
  <div class="header">
    <!-- Animated Sun -->
    <svg class="sun" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="18" fill="#FFD93B"/>
      <g stroke="#FFD93B" stroke-width="4">
        <line x1="50" y1="2" x2="50" y2="18"/>
        <line x1="50" y1="82" x2="50" y2="98"/>
        <line x1="2" y1="50" x2="18" y2="50"/>
        <line x1="82" y1="50" x2="98" y2="50"/>
        <line x1="15" y1="15" x2="26" y2="26"/>
        <line x1="74" y1="74" x2="85" y2="85"/>
        <line x1="15" y1="85" x2="26" y2="74"/>
        <line x1="74" y1="26" x2="85" y2="15"/>
      </g>
    </svg>
    <h1>Apple Weather Pro</h1>
  </div>

  <!-- Search -->
  <input id="q" placeholder="ÂüéÂ∏Ç / City / ÈÉΩÂ∏Ç" />
  <button onclick="search()">ÊêúÁ¥¢ / Search</button>

  <div id="result"></div>

</div>

<script>
/* ======================
   Config
====================== */
const PROXY = '/proxy';

/* WMO Weather Mapping */
const WMO = {
  0: "‚òÄÔ∏è Clear",
  1: "üå§Ô∏è Mostly Clear",
  2: "‚õÖ Partly Cloudy",
  3: "‚òÅÔ∏è Cloudy",
  45: "üå´Ô∏è Fog",
  48: "üå´Ô∏è Fog",
  51: "üå¶Ô∏è Drizzle",
  61: "üåßÔ∏è Rain",
  63: "üåßÔ∏è Heavy Rain",
  71: "‚ùÑÔ∏è Snow",
  73: "‚ùÑÔ∏è Heavy Snow",
  95: "‚õàÔ∏è Storm"
};

/* ======================
   Helpers
====================== */
async function proxyFetch(url) {
  const res = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
  if (!res.ok) throw new Error('Proxy error');
  return res.json();
}

/* Geocoding */
async function geocode(q) {
  return proxyFetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`
  );
}

/* Weather */
async function weather(lat, lon) {
  return proxyFetch(
    `https://api.open-meteo.com/v1/forecast` +
    `?latitude=${lat}&longitude=${lon}` +
    `&current_weather=true` +
    `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,windspeed_10m_max,weathercode` +
    `&forecast_days=7` +
    `&timezone=auto`
  );
}

/* ======================
   Main Logic
====================== */
async function search() {
  const q = document.getElementById('q').value.trim();
  if (!q) return;

  document.getElementById('result').innerHTML = 'Loading‚Ä¶';

  try {
    const geo = await geocode(q);
    const w = await weather(geo[0].lat, geo[0].lon);
    render(w, geo[0].display_name);
  } catch (e) {
    document.getElementById('result').innerHTML = 'Error loading data';
  }
}

/* Render */
function render(data, city) {
  const c = data.current_weather;
  const d = data.daily;

  let html = `
    <div class="card">
      <div class="small">${city}</div>
      <div class="big">${c.temperature}¬∞C</div>
      <div class="icon">${WMO[c.weathercode] || ''}</div>
      <div class="small">
        Wind ${c.windspeed} km/h
      </div>
    </div>

    <div class="forecast">
  `;

  for (let i = 0; i < d.time.length; i++) {
    html += `
      <div class="day">
        <div class="small">${d.time[i]}</div>
        <div class="icon">${WMO[d.weathercode[i]] || ''}</div>
        <div>${d.temperature_2m_max[i]}¬∞ / ${d.temperature_2m_min[i]}¬∞</div>
        <div class="small">Rain ${d.precipitation_sum[i]} mm</div>
        <div class="small">Wind ${d.windspeed_10m_max[i]} km/h</div>
      </div>
    `;
  }

  html += `</div>`;
  document.getElementById('result').innerHTML = html;
}

/* ======================
   Auto IP Locate
====================== */
(async () => {
  try {
    const loc = await proxyFetch('https://ipapi.co/json/');
    document.getElementById('q').value = loc.city;
    search();
  } catch {}
})();
</script>
</body>
</html>
