<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Apple Weather Pro</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0a1d37">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
  background: linear-gradient(#0a1d37, #071426);
  color: #fff;
}
.container {
  max-width: 480px;
  margin: 0 auto;
  padding: 16px;
}
h1 {
  display: flex;
  align-items: center;
  gap: 10px;
}
input, button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  margin-bottom: 8px;
}
button {
  background: #4f7cff;
  color: white;
  font-weight: 600;
}
.card {
  background: rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 16px;
  margin-top: 12px;
}
.forecast {
  display: flex;
  overflow-x: auto;
  gap: 10px;
  margin-top: 12px;
}
.day {
  min-width: 120px;
  background: rgba(255,255,255,0.12);
  border-radius: 14px;
  padding: 10px;
  text-align: center;
}
.small { opacity: 0.7; font-size: 12px; }
.big { font-size: 32px; font-weight: 600; }

#suggest {
  background: rgba(0,0,0,0.6);
  border-radius: 12px;
  overflow: hidden;
}
.s-item {
  padding: 10px;
  cursor: pointer;
}
.s-item:hover {
  background: rgba(255,255,255,0.15);
}

/* ğŸŒ å¤ªé˜³ SVG åŠ¨ç”» */
.sun {
  width: 32px;
  height: 32px;
  animation: spin 12s linear infinite;
}
@keyframes spin {
  from { transform: rotate(0); }
  to { transform: rotate(360deg); }
}
</style>
</head>

<body>
<div class="container">

<h1>
<svg class="sun" viewBox="0 0 100 100">
  <circle cx="50" cy="50" r="20" fill="#FFD93B"/>
  <g stroke="#FFD93B" stroke-width="6">
    <line x1="50" y1="5" x2="50" y2="20"/>
    <line x1="50" y1="80" x2="50" y2="95"/>
    <line x1="5" y1="50" x2="20" y2="50"/>
    <line x1="80" y1="50" x2="95" y2="50"/>
  </g>
</svg>
Apple Weather Pro
</h1>

<input id="q" placeholder="åŸå¸‚ / City / éƒ½å¸‚" oninput="suggestCity(this.value)" />
<div id="suggest"></div>
<button onclick="search()">æœç´¢ / Search</button>

<div id="result"></div>

</div>

<script>
const PROXY = '/proxy';

const WMO = {
  0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",
  45:"ğŸŒ«ï¸",61:"ğŸŒ§ï¸",71:"â„ï¸",95:"â›ˆï¸"
};

async function proxyFetch(url){
  const r = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
  return r.json();
}

/* åŸå¸‚è‡ªåŠ¨è¡¥å…¨ */
async function suggestCity(q){
  if(q.length<2){suggest.innerHTML='';return;}
  const res = await proxyFetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=5`
  );
  suggest.innerHTML = res.map(r =>
    `<div class="s-item" onclick="pick('${r.display_name}',${r.lat},${r.lon})">${r.display_name}</div>`
  ).join('');
}

function pick(name,lat,lon){
  q.value=name;
  suggest.innerHTML='';
  loadWeather(lat,lon,name);
}

async function geocode(q){
  return proxyFetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=1`
  );
}

async function weather(lat,lon){
  return proxyFetch(
    `https://api.open-meteo.com/v1/forecast` +
    `?latitude=${lat}&longitude=${lon}` +
    `&current_weather=true` +
    `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,windspeed_10m_max,weathercode` +
    `&timezone=auto`
  );
}

async function search(){
  if(!q.value) return;
  const g = await geocode(q.value);
  loadWeather(g[0].lat,g[0].lon,g[0].display_name);
}

async function loadWeather(lat,lon,city){
  result.innerHTML='Loading...';
  const w = await weather(lat,lon);
  render(w,city);
}

function render(data,city){
  const c=data.current_weather,d=data.daily;
  let html=`
  <div class="card">
    <div class="small">${city}</div>
    <div class="big">${c.temperature}Â°C ${WMO[c.weathercode]}</div>
    <div class="small">Wind ${c.windspeed} km/h</div>
  </div>
  <div class="forecast">`;
  for(let i=0;i<d.time.length;i++){
    html+=`
    <div class="day">
      <div class="small">${d.time[i]}</div>
      <div>${WMO[d.weathercode[i]]}</div>
      <div>${d.temperature_2m_max[i]}Â° / ${d.temperature_2m_min[i]}Â°</div>
      <div class="small">Rain ${d.precipitation_sum[i]}mm</div>
    </div>`;
  }
  html+='</div>';
  result.innerHTML=html;
}

/* PWA */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js');
}
</script>
</body>
</html>
