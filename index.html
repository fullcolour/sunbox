<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalHub | æ·±åº¦æ°”è±¡ä¸é‡‘èç»ˆç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --apple-blue: #0071e3; --glass: rgba(255, 255, 255, 0.75); }
        body {
            background: #f2f2f7;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            color: #1d1d1f;
        }
        .apple-glass {
            background: var(--glass);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 24px;
        }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .currency-pill {
            transition: all 0.2s;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .currency-pill.active {
            background: var(--apple-blue);
            color: white;
            border-color: var(--apple-blue);
        }
        .weather-day-card {
            min-width: 85px;
            background: rgba(255,255,255,0.4);
            border-radius: 16px;
            padding: 12px 8px;
            text-align: center;
        }
        .history-tag { background: #ff9500; color: white; font-size: 10px; padding: 2px 4px; border-radius: 4px; position: absolute; top: -8px; }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12">

    <div class="max-w-6xl mx-auto space-y-8">
        
        <header class="flex flex-col md:flex-row justify-between items-end mb-8 animate__animated animate__fadeIn">
            <div>
                <h1 class="text-4xl font-bold tracking-tight">å¤ªé˜³å¤©æ°”ä¸æ±‡ç‡>å¤ªé˜³>>
                <p class="text-gray-500 font-medium">å®æ—¶æ•°æ®ï¼Œæé€ŸæŸ¥è¯¢>sp>
            </div>
            <div id="current-time" class="text-sm font-mono text-gray-400 mt-2 md:mt-0"></div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <section class="apple-glass p-8 flex flex-col space-y-6 animate__animated animate__fadeInLeft">
                <h2 class="text-xl font-bold flex items-center">ğŸ’µ æ±‡ç‡è½¬æ¢å™¨</h2>
                
                <div class="space-y-4">
                    <div>
                        <span class="text-xs font-bold text-gray-400 block mb-2">æ¢ç®—é‡‘é¢</span>
                        <input id="amount" type="number" value="100" class="w-full p-4 rounded-xl bg-gray-100/50 border-none outline-none focus:ring-2 ring-blue-500 text-2xl font-bold">
                    </div>

                    <div class="space-y-3">
                        <span class="text-xs font-bold text-gray-400 block">åŸºç¡€è´§å¸ (From)</span>
                        <div id="from-list" class="flex flex-wrap gap-2">
                            </div>
                    </div>

                    <div class="space-y-3">
                        <span class="text-xs font-bold text-gray-400 block">ç›®æ ‡è´§å¸ (To)</span>
                        <div id="to-list" class="flex flex-wrap gap-2">
                            </div>
                    </div>

                    <button onclick="updateExchange()" class="w-full bg-[#0071e3] text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-blue-500/20 active:scale-95 transition-all">æ‰§è¡Œæ¢ç®—</button>
                    
                    <div id="rate-display" class="bg-white/60 p-6 rounded-2xl text-center hidden animate__animated animate__fadeInUp">
                        <p class="text-sm text-gray-400 mb-1" id="rate-info">--</p>
                        <p class="text-4xl font-black text-blue-600 tracking-tighter" id="rate-result">0.00</p>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-2 apple-glass p-8 space-y-8 animate__animated animate__fadeInRight">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <h2 class="text-xl font-bold flex items-center">ğŸŒ¤ï¸ 21å¤©æ·±åº¦æ°”è±¡è½¨è¿¹</h2>
                    <div class="flex w-full md:w-auto gap-2">
                        <input id="city-input" type="text" placeholder="åŸå¸‚(å¦‚: Tokyo)" class="flex-1 md:w-48 p-3 rounded-xl bg-gray-100/50 border-none outline-none focus:ring-2 ring-blue-500">
                        <button onclick="fetchWeather()" class="bg-black text-white px-6 py-3 rounded-xl font-bold active:scale-95 transition-all">æŸ¥è¯¢</button>
                    </div>
                </div>

                <div id="weather-now" class="grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                    <div class="bg-blue-500 text-white p-6 rounded-3xl col-span-2 flex flex-col justify-between">
                        <p id="now-city" class="text-xl font-bold uppercase tracking-widest">---</p>
                        <p id="now-temp" class="text-6xl font-black my-4 tracking-tighter">--Â°</p>
                        <p class="text-sm opacity-80">å½“å‰å®å†µæ°”æ¸©</p>
                    </div>
                    <div class="bg-white/40 p-4 rounded-2xl flex flex-col justify-center items-center text-center">
                        <span class="text-xs font-bold text-gray-400">é£é€Ÿ</span>
                        <p id="now-wind" class="text-xl font-bold mt-1">-- km/h</p>
                    </div>
                    <div class="bg-white/40 p-4 rounded-2xl flex flex-col justify-center items-center text-center">
                        <span class="text-xs font-bold text-gray-400">é£å‘åº¦æ•°</span>
                        <p id="now-dir" class="text-xl font-bold mt-1">--Â°</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center px-1">
                        <span class="text-sm font-bold text-gray-400 uppercase tracking-widest">å†å²ä¸é¢„æµ‹åºåˆ— (å‰10å¤© - å10å¤©)</span>
                        <span class="text-xs text-blue-500">æ¨ªå‘æ»šåŠ¨æŸ¥çœ‹ â†’</span>
                    </div>
                    <div id="timeline" class="flex gap-4 overflow-x-auto pb-4 hide-scroll h-32">
                        <div class="w-full text-center text-gray-300 py-8">è¾“å…¥åŸå¸‚åä»¥åŠ è½½æ°”è±¡æ—¶é—´è½´æ•°æ®</div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        const currencies = [
            {code: 'CNY', name: 'äººæ°‘å¸'}, {code: 'USD', name: 'ç¾å…ƒ'},
            {code: 'JPY', name: 'æ—¥å…ƒ'}, {code: 'EUR', name: 'æ¬§å…ƒ'},
            {code: 'THB', name: 'æ³°é“¢'}, {code: 'AUD', name: 'æ¾³å…ƒ'},
            {code: 'CAD', name: 'åŠ å¸'}, {code: 'GBP', name: 'è‹±é•‘'}
        ];

        let fromCur = 'USD', toCur = 'CNY';

        // åˆå§‹åŒ–æ±‡ç‡åˆ—è¡¨
        function initCurrencies() {
            const fList = document.getElementById('from-list');
            const tList = document.getElementById('to-list');
            currencies.forEach(c => {
                fList.innerHTML += `<button onclick="setCur('from','${c.code}')" id="from-${c.code}" class="currency-pill px-4 py-2 rounded-full text-sm font-medium ${c.code==='USD'?'active':''}">${c.code}</button>`;
                tList.innerHTML += `<button onclick="setCur('to','${c.code}')" id="to-${c.code}" class="currency-pill px-4 py-2 rounded-full text-sm font-medium ${c.code==='CNY'?'active':''}">${c.code}</button>`;
            });
        }

        function setCur(type, code) {
            if(type === 'from') {
                document.querySelectorAll('#from-list button').forEach(b => b.classList.remove('active'));
                document.getElementById(`from-${code}`).classList.add('active');
                fromCur = code;
            } else {
                document.querySelectorAll('#to-list button').forEach(b => b.classList.remove('active'));
                document.getElementById(`to-${code}`).classList.add('active');
                toCur = code;
            }
        }

        async function updateExchange() {
            const amount = document.getElementById('amount').value;
            const resBox = document.getElementById('rate-display');
            try {
                const res = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCur}`);
                const data = await res.json();
                const rate = data.rates[toCur];
                document.getElementById('rate-result').innerText = (amount * rate).toLocaleString(undefined, {minimumFractionDigits: 2});
                document.getElementById('rate-info').innerText = `1 ${fromCur} â‰ˆ ${rate.toFixed(4)} ${toCur}`;
                resBox.classList.remove('hidden');
            } catch(e) { alert("æ±‡ç‡æœåŠ¡æš‚æ—¶ä¸å¯ç”¨"); }
        }

        async function fetchWeather() {
            const city = document.getElementById('city-input').value;
            const timeline = document.getElementById('timeline');
            if(!city) return;

            try {
                // 1. åœ°ç†å®šä½
                const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
                const geoData = await geoRes.json();
                if(!geoData.results) throw new Error();
                const { latitude, longitude, name } = geoData.results[0];

                // 2. è®¡ç®—æ—¥æœŸè·¨åº¦ (å‰10å¤© åˆ° å10å¤©)
                const today = new Date();
                const startDate = new Date(today); startDate.setDate(today.getDate() - 10);
                const endDate = new Date(today); endDate.setDate(today.getDate() + 10);
                
                const fmtDate = (d) => d.toISOString().split('T')[0];

                // 3. å¹¶å‘è·å–å†å²ä¸é¢„æµ‹æ•°æ®
                const [histRes, foreRes] = await Promise.all([
                    fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${latitude}&longitude=${longitude}&start_date=${fmtDate(startDate)}&end_date=${fmtDate(new Date(today.getTime()-86400000))}&daily=temperature_2m_max`),
                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&daily=temperature_2m_max&timezone=auto`)
                ]);

                const histData = await histRes.json();
                const foreData = await foreRes.json();

                // æ¸²æŸ“å®å†µ
                document.getElementById('weather-now').classList.remove('hidden');
                document.getElementById('now-city').innerText = name;
                document.getElementById('now-temp').innerText = Math.round(foreData.current_weather.temperature) + 'Â°';
                document.getElementById('now-wind').innerText = foreData.current_weather.windspeed + ' km/h';
                document.getElementById('now-dir').innerText = foreData.current_weather.winddirection + 'Â°';

                // åˆå¹¶æ—¶é—´è½´
                timeline.innerHTML = '';
                
                // å†å²æ•°æ®éƒ¨åˆ†
                histData.daily.time.forEach((t, i) => {
                    const day = t.split('-').slice(1).join('/');
                    timeline.innerHTML += `
                        <div class="weather-day-card relative opacity-60">
                            <span class="history-tag">å†å²</span>
                            <p class="text-[10px] font-bold text-gray-400 mb-1">${day}</p>
                            <p class="text-lg font-black">${Math.round(histData.daily.temperature_2m_max[i])}Â°</p>
                        </div>`;
                });

                // é¢„æµ‹æ•°æ®éƒ¨åˆ† (å«ä»Šæ—¥)
                foreData.daily.time.forEach((t, i) => {
                    const isToday = i === 0;
                    const day = t.split('-').slice(1).join('/');
                    timeline.innerHTML += `
                        <div class="weather-day-card ${isToday?'ring-2 ring-blue-500 bg-white shadow-sm':''}">
                            <p class="text-[10px] font-bold ${isToday?'text-blue-500':'text-gray-400'} mb-1">${isToday?'ä»Šæ—¥':day}</p>
                            <p class="text-lg font-black">${Math.round(foreData.daily.temperature_2m_max[i])}Â°</p>
                        </div>`;
                });

                // æ»šåŠ¨åˆ°ä»Šæ—¥ä½ç½® (ä¸­é—´)
                setTimeout(() => timeline.scrollTo({left: 85 * 9, behavior: 'smooth'}), 500);

            } catch(e) { alert("æ‰¾ä¸åˆ°è¯¥åŸå¸‚æˆ–æ°”è±¡ç«™è¿æ¥å¤±è´¥"); }
        }

        // æ—¶é—´æ›´æ–°
        setInterval(() => {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleString();
        }, 1000);

        window.onload = () => { initCurrencies(); updateExchange(); };
    </script>
</body>
</html>
