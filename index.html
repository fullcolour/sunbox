<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weather</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0a0f2c" />

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
  background: radial-gradient(circle at top, #1b2b5f, #050916);
  color: white;
}

header {
  display: flex;
  align-items: center;
  padding: 24px;
  gap: 12px;
}

.sun {
  width: 42px;
  height: 42px;
  animation: spin 20s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

input {
  width: 100%;
  padding: 18px;
  border-radius: 18px;
  border: none;
  font-size: 18px;
  margin: 20px;
}

button {
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(135deg, #6dd5fa, #2980b9);
  color: white;
}

.card {
  background: rgba(255,255,255,0.08);
  border-radius: 24px;
  padding: 24px;
  margin: 20px;
  backdrop-filter: blur(20px);
}

.days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
  margin-top: 20px;
}

.day {
  background: rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 10px;
  text-align: center;
}
</style>
</head>

<body>

<header>
<svg class="sun" viewBox="0 0 100 100">
<circle cx="50" cy="50" r="20" fill="#FFD93B"/>
</svg>
<h1>Weather</h1>
</header>

<input id="city" placeholder="Tokyo / æ±äº¬ / æ±äº¬" />
<button onclick="search()">Search</button>

<div class="card" id="current"></div>
<div class="card">
  <h3>7 Day Forecast</h3>
  <div class="days" id="forecast"></div>
</div>

<script>
const WMO = {
  0: "â˜€ï¸",
  1: "ğŸŒ¤ï¸",
  2: "â›…",
  3: "â˜ï¸",
  45: "ğŸŒ«ï¸",
  48: "ğŸŒ«ï¸",
  51: "ğŸŒ¦ï¸",
  61: "ğŸŒ§ï¸",
  71: "â„ï¸",
  95: "â›ˆï¸"
};

async function search() {
  const city = document.getElementById("city").value;
  const geo = await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${city}`
  ).then(r => r.json());

  const loc = geo.results[0];
  loadWeather(loc.latitude, loc.longitude, loc.name);
}

async function loadWeather(lat, lon, name) {
  const res = await fetch(`/weather?lat=${lat}&lon=${lon}`);
  const data = await res.json();

  document.getElementById("current").innerHTML = `
    <h2>${name}</h2>
    <p>ğŸŒ¡ï¸ ${data.current_weather.temperature}Â°C</p>
    <p>ğŸ’¨ ${data.current_weather.windspeed} km/h</p>
  `;

  const days = data.daily.time.map((d, i) => `
    <div class="day">
      <div>${d.slice(5)}</div>
      <div>${WMO[data.daily.weathercode[i]] || "â”"}</div>
      <div>${data.daily.temperature_2m_max[i]}Â° / ${data.daily.temperature_2m_min[i]}Â°</div>
    </div>
  `).join("");

  document.getElementById("forecast").innerHTML = days;
}

// IP è‡ªåŠ¨å®šä½
navigator.geolocation.getCurrentPosition(pos => {
  loadWeather(pos.coords.latitude, pos.coords.longitude, "Current Location");
});
</script>

</body>
</html>
