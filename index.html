<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weather ¬∑ Apple Style</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b1220;
  --card:#111827;
  --text:#e5edff;
  --muted:rgba(255,255,255,.65);
  --accent:#60a5fa;
  font-family:Inter,system-ui,-apple-system;
}
html,body{
  margin:0;height:100%;
  background:linear-gradient(180deg,#0b1220,#020617);
  color:var(--text);
}
.container{
  max-width:420px;
  margin:0 auto;
  padding:20px;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.city{
  font-size:22px;
  font-weight:700;
}
.temp{
  font-size:56px;
  font-weight:700;
  margin-top:10px;
}
.desc{
  color:var(--muted);
}
.card{
  background:rgba(255,255,255,.04);
  border-radius:18px;
  padding:16px;
  margin-top:14px;
  backdrop-filter:blur(10px);
}
.row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  padding:6px 0;
  color:var(--muted);
}
.forecast{
  display:flex;
  overflow-x:auto;
  gap:12px;
  margin-top:10px;
}
.day{
  min-width:100px;
  background:rgba(255,255,255,.05);
  border-radius:14px;
  padding:10px;
  text-align:center;
}
.day .t{
  font-weight:600;
}
input,button{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
button{
  background:var(--accent);
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <div class="city" id="city">‚Äî</div>
  </div>

  <input id="q" placeholder="Search city (Osaka / Tokyo)" />
  <button onclick="search()">Search</button>

  <div class="temp" id="temp">‚Äî</div>
  <div class="desc" id="desc"></div>

  <div class="card" id="details"></div>

  <div class="card">
    <div style="font-weight:600;margin-bottom:8px">7-Day Forecast</div>
    <div class="forecast" id="forecast"></div>
  </div>

</div>

<script>
const PROXY = "/proxy";

async function proxyFetch(url){
  const res = await fetch(PROXY + "?url=" + encodeURIComponent(url));
  if(!res.ok) throw new Error("Proxy error");
  return res.json();
}

async function geocode(q){
  return proxyFetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`
  );
}

async function weather(lat,lon){
  return proxyFetch(
    `https://api.open-meteo.com/v1/forecast` +
    `?latitude=${lat}&longitude=${lon}` +
    `&current_weather=true` +
    `&daily=` +
    `temperature_2m_max,temperature_2m_min,` +
    `precipitation_sum,` +
    `windspeed_10m_max,` +
    `weathercode` +
    `&forecast_days=7` +
    `&timezone=auto`
  );
}

function wmo(code){
  if(code===0) return "‚òÄÔ∏è Clear";
  if(code<=3) return "‚õÖ Cloudy";
  if(code<=48) return "üå´Ô∏è Fog";
  if(code<=67) return "üåßÔ∏è Rain";
  if(code<=77) return "‚ùÑÔ∏è Snow";
  if(code<=99) return "‚õàÔ∏è Storm";
  return "üå°Ô∏è";
}

async function search(){
  const q = document.getElementById("q").value;
  if(!q) return;

  const geo = await geocode(q);
  if(!geo.length) return alert("City not found");

  const c = geo[0];
  document.getElementById("city").textContent = c.display_name.split(",")[0];

  const data = await weather(c.lat,c.lon);

  const cw = data.current_weather;
  document.getElementById("temp").textContent = Math.round(cw.temperature) + "¬∞";
  document.getElementById("desc").textContent = wmo(cw.weathercode);

  document.getElementById("details").innerHTML = `
    <div class="row"><span>Wind</span><span>${cw.windspeed} km/h</span></div>
    <div class="row"><span>Direction</span><span>${cw.winddirection}¬∞</span></div>
    <div class="row"><span>Time</span><span>${cw.time}</span></div>
  `;

  const d = data.daily;
  const f = document.getElementById("forecast");
  f.innerHTML = "";

  d.time.forEach((day,i)=>{
    f.innerHTML += `
      <div class="day">
        <div>${day.slice(5)}</div>
        <div>${wmo(d.weathercode[i])}</div>
        <div class="t">${Math.round(d.temperature_2m_max[i])}¬∞</div>
        <div class="t" style="color:#93c5fd">${Math.round(d.temperature_2m_min[i])}¬∞</div>
        <div style="font-size:12px;color:var(--muted)">
          üíß ${d.precipitation_sum[i]} mm
        </div>
      </div>
    `;
  });
}
</script>
</body>
</html>
