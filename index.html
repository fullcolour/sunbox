<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Apple Weather Pro</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
  background: linear-gradient(#0a1d37, #071426);
  color: #fff;
}
.container {
  max-width: 480px;
  margin: 0 auto;
  padding: 16px;
}
input, button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  margin-bottom: 10px;
}
button {
  background: #4f7cff;
  color: white;
  font-weight: 600;
}
.card {
  background: rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 16px;
  margin-top: 12px;
}
.forecast {
  display: flex;
  overflow-x: auto;
  gap: 10px;
}
.day {
  min-width: 120px;
  background: rgba(255,255,255,0.12);
  border-radius: 14px;
  padding: 10px;
  text-align: center;
}
.small { opacity: 0.7; font-size: 12px; }
.big { font-size: 32px; font-weight: 600; }
</style>
</head>

<body>
<div class="container">

  <input id="q" placeholder="åŸå¸‚ / City / éƒ½å¸‚" />
  <button onclick="search()">æœç´¢ / Search</button>

  <div id="result"></div>

</div>

<script>
const PROXY = '/proxy';

const WMO = {
  0: "â˜€ï¸ Clear",
  1: "ğŸŒ¤ï¸ Mostly Clear",
  2: "â›… Partly Cloudy",
  3: "â˜ï¸ Cloudy",
  45: "ğŸŒ«ï¸ Fog",
  61: "ğŸŒ§ï¸ Rain",
  71: "â„ï¸ Snow",
  95: "â›ˆï¸ Storm"
};

async function proxyFetch(url) {
  const res = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
  return res.json();
}

async function geocode(q) {
  return proxyFetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=1`
  );
}

async function weather(lat, lon) {
  return proxyFetch(
    `https://api.open-meteo.com/v1/forecast` +
    `?latitude=${lat}&longitude=${lon}` +
    `&current_weather=true` +
    `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,windspeed_10m_max,weathercode` +
    `&timezone=auto`
  );
}

async function search() {
  const q = document.getElementById('q').value;
  if (!q) return;

  document.getElementById('result').innerHTML = 'Loading...';

  try {
    const geo = await geocode(q);
    const w = await weather(geo[0].lat, geo[0].lon);

    render(w, geo[0].display_name);
  } catch (e) {
    document.getElementById('result').innerHTML = 'Error';
  }
}

function render(data, city) {
  const c = data.current_weather;
  const d = data.daily;

  let html = `
    <div class="card">
      <div class="small">${city}</div>
      <div class="big">${c.temperature}Â°C</div>
      <div>${WMO[c.weathercode] || ''}</div>
      <div class="small">Wind ${c.windspeed} km/h</div>
    </div>

    <div class="forecast">
  `;

  for (let i = 0; i < d.time.length; i++) {
    html += `
      <div class="day">
        <div class="small">${d.time[i]}</div>
        <div>${WMO[d.weathercode[i]] || ''}</div>
        <div>${d.temperature_2m_max[i]}Â° / ${d.temperature_2m_min[i]}Â°</div>
        <div class="small">Rain ${d.precipitation_sum[i]}mm</div>
      </div>
    `;
  }

  html += `</div>`;

  document.getElementById('result').innerHTML = html;
}
</script>
</body>
</html>
